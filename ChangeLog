2001-07-23  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-main.c (main): add version
	output.

2001-07-23  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_poa):
	only free the return value if there is no exception.

2001-07-20  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/iop-profiles.c (IOP_generate_profiles): 
	remove 'need_object_key_component' - we always do, to flag
	UTF-8.
	(IOP_profile_get_info): fallback to obj->oki if coki is NULL.
	(IOP_components_marshal): hook up CODE_SETS.
	(IOP_TAG_CODE_SETS_marshal): impl.
	(CodeSetComponent_marshal): impl.
	(IOP_components_demarshal): upd.
	(CodeSetComponent_demarshal): impl.
	(IOP_component_free): upd.

2001-07-20  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-send-buffer.c
	(giop_send_buffer_append_indirect): rename to
	(giop_send_buffer_append_aligned): this, to make not only
	more efficient, but clean and sane.
	(giop_send_buffer_align): re-write to be actualy fast,
	remove the 'register' keyword - it doesn't speed things up.
	(get_next_indirect): split out of _append & re-write.
	(giop_send_buffer_append_aligned): here & re-write.
	(giop_send_buffer_append_copy): impl simple version for
	(giop_send_buffer_append): to use & upd.

	* src/orb/orb-core/iop-profiles.c: upd.

	* src/orb/orb-core/corba-context.c: upd.

	* src/orb/orb-core/corba-any.c: upd.

	* src/orb/orb-core/corba-typecode.c: upd.

	* src/orb/orb-core/corba-env.c: upd.

	* src/orb/orb-core/corba-object.c: upd.

	* src/orb/orb-core/orbit-small.c: upd.
	
2001-07-19  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (ORBit_POAObject_release_cb): try
	freeing the object_id before we free the pobj we need
	to reference it, also NULL it for safety.

2001-07-19  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c: remove redundant
	DEBUG_LOCAL_TEST macro ...

	* src/orb/GIOP/giop-connection.c
	(giop_connection_real_state_changed): use
	linc watches.

2001-07-18  Michael Meeks  <michael@ximian.com>

	* test/echo-server.c (main): use CORBA_ORB_run.

	* src/orb/orb-core/corba-orb.c
	(CORBA_ORB_perform_work, CORBA_ORB_work_pending),
	(CORBA_ORB_run): use new linc_main stuff instead of
	g_main.

	* src/orb/GIOP/giop-recv-buffer.c
	(giop_recv_buffer_get): use linc_main_iteration, this
	requires the latest CVS linc.
	(giop_recv_buffer_use): ditto.

2001-07-18  Mark McLoughlin <mark@skynet.ie>

	* src/idl-compiler/orbit-idl-c-headers.c(ch_output_native),
	  src/idl-compiler/orbit-idl-c-stubs.c(cs_small_output_stub):
	add a couple of '\n's to the generated code. We shouldn't rely
	on indent to fix up broken code.

2001-07-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c 
	(_ORBit_object_get_connection): rename to
	(ORBit_object_get_connection): this & re-order slightly.
	(CORBA_Object_non_existent): local objects always exist,
	even if we havn't bothered remoting them yet => no
	connection.

	* include/orbit/orb-core/corba-object.h: kill macro
	(ORBit_object_get_connection): somewhat confusing.

	* test/everything/client.c (testIInterface): add
	CORBA_Object_non_existent and CORBA_Object_is_nil
	regression tests.

2001-07-17  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-main.c (main): make
	the runtime message more pleasant.

	* src/orb/orb-core/corba-object.c
	(ORBit_IInterface_is_a): upd. to sequence<String>

	* src/idl-compiler/orbit-idl-c-common.c
	(cc_small_output_itypes): output sequence<string> for
	base types & get the length right.
	(cc_small_output_base_itypes): upd.

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_invoke_skel): kill.
	(ORBit_small_invoke): impl.

	* configure.in (ORBIT_SERIAL): bump.

	* src/orb/orb-core/orbit-interface.idl: switch
	to sequence<string> for base_interfaces.

2001-07-17  Michael Meeks  <michael@ximian.com>

	* test/everything/client.c (testIInterface): 
	ORBit_small_get_type_id regression test.
	(run_tests): hook it up.

	* src/orb/poa/poa.c (ORBit_classinfo_lookup): impl.

	* src/orb/poa/clean-poa.c (ORBit_classinfo_lookup): impl.

	* src/orb/orb-core/corba-object.c
	(ORBit_impl_ORBit_get_iinterface): impl.
	(ORBit_impl_ORBit_get_type_id): impl.
	(get_small_skel_CORBA_Object): extend.

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_get_iinterface): impl.
	(ORBit_small_get_type_id): impl.

	* src/orb/orb-core/corba-object.c: add
	ORBit_get_iinterface / ORBit_get_type_id methods.

2001-07-13  Peter Williams  <peterw@ximian.com>

	* configure.in (ACLOCAL): Preserve ACLOCAL_FLAGS in
	ACLOCAL. (Update: whoops, typo! Fixed.) (Update: I
	do not believe it. Fix another typo.)

2001-07-14  Martin Baulig  <baulig@suse.de>

	* ORBit-2.0.pc.in (orbit_idl): New variable.

2001-07-13  Mark McLoughlin <mark@skynet.ie>

	* docs/devel/internals/poa-notes.txt: added.

2001-07-13  Michael Meeks  <michael@ximian.com>

	* test/everything/client.c (testString): use the getIOR
	method to test stringification.

	* test/everything/server.c
	(TestFactory_getBasicServerIOR): impl.

2001-07-13  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (ORBit_small_handle_request):
	re-indent to make legible.

	* src/orb/orb-core/corba-object.c (CORBA_Object_is_a): 
	fix invocation code.
	(ORBit_impl_CORBA_Object_is_a): fix indirection.
	Thanks to Martin Baulig for reporting repo_id matching
	bug.

	* test/everything/client.c (testFixedLengthStruct): 
	add CORBA_Object_is_a test.

	* src/orb/orb-core/allocators.c
	(ORBit_freekids_via_TypeCode_T): kill broken assumption
	that align == length !

	* src/orb/orb-core/corba-typecode.c
	(ORBit_tk_to_name): impl.

	* test/test-dynany.c: portability fix for CHECK_OK.

2001-07-12  Darin Adler  <darin@bentspoon.com>

	* include/orbit/poa/Makefile.am: Install poa-basics.h.

2001-07-12  Mark McLoughlin <mark@skynet.ie>

	* src/idl-compiler/orbit-idl-c-common.c,
	  src/orb/orb-core/orbit-interface.idl,
	(IInterface)change name string to typcode.

	* src/orb/orb-core/corba-object.c,
	  src/orb/orb-core/orb-core-export.h,
	  src/orb/poa/poa.c: re-jig CORBA_Object_is_a
	using the IInterface data.

2001-07-12  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (ORBit_register_objref):
	assert profile_list != NULL.

	* src/orb/poa/poa.c (ORBit_POA_object_to_okey): add precondition.

	* src/orb/orb-core/iop-profiles.c
	(IOP_TAG_ORBIT_SPECIFIC_marshal): use the local oki if we have it.
	(IOP_TAG_INTERNET_IOP_marshal): use obj->oki where appropriate.
	(IOP_generate_profiles): only set obj->oki if we have a pobj.

	* NB. obj->oki == NULL for objects passed in remotely, need
	to bear this in mind when re-marshaling the profiles.
	
2001-07-12  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/corba-object.h,
	  src/idl-compiler/orbit-idl-c-common.c,
	  src/idl-compiler/orbit-idl-c-skels.c,
	  src/orb/orb-core/corba-object.c,
	  src/orb/poa/orbit-poa.h,
	  src/orb/poa/poa.c:
	add IInterface data for CORBA_object.

	* include/orbit/orbit-types.h,
	  include/orbit/poa/poa-types.h,
	  include/orbit/poa/poa-basics.h: split out
	some of poa-types.h into new poa-basics.h. Include
	poa-basics.h from orbit-types.h.

	* include/orbit/orb-core/corba-object-type.h,
	  include/orbit/poa/poa-types.h,
	  include/orbit/poa/poa.h,
	  src/orb/orb-core/orbit-small.c,
	  src/orb/poa/orbit-poa-export.h:
	make ORBit_POAObject a pointer to ORBit_POAObject_type
	instead of a struct.

2001-07-12  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/orbit-small.h,
	  include/orbit/poa/poa-types.h,
	  src/idl-compiler/orbit-idl-c-backend.h,
	  src/idl-compiler/orbit-idl-c-common.c,
	  src/idl-compiler/orbit-idl-c-demarshal.c,
	  src/idl-compiler/orbit-idl-c-headers.c,
	  src/idl-compiler/orbit-idl-c-marshal.c,
	  src/idl-compiler/orbit-idl-c-skels.c,
	  src/idl-compiler/orbit-idl-c-stubs.c,
	  src/idl-compiler/orbit-idl-c-utils.c,
	  src/idl-compiler/orbit-idl-main.c,
	  src/orb/dynamic/Makefile.am,
	  src/orb/orb-core/orbit-small.c,
	  src/orb/poa/Makefile.am,
	  src/orb/poa/poa.c: put all the 'non-small'
	code back, at Elliot's behest.

	Note: The --noidata option remains and the PIDL is 
	still no longer being compiled with --oldstyle.

        * configure.in: bump up ORBIT_SERIAL.
		
2001-07-11  Mark McLoughlin <mark@skynet.ie>

	* src/idl-compiler/orbit-idl-c-headers.c
	(ch_type_alloc_and_tc): do the allocbuf thing.

	* src/orb/dynamic/dynany.c,
	  src/orb/poa/poa.c,
	  test/poa/poatest-exception.h: kill temporary
	hacks for the above.

2001-07-11  Mark McLoughlin <mark@skynet.ie>

        * src/idl-compiler/orbit-idl-c-backend.h,
          src/idl-compiler/orbit-idl-c-common.c,
          src/idl-compiler/orbit-idl-c-demarshal.c,
          src/idl-compiler/orbit-idl-c-headers.c,
          src/idl-compiler/orbit-idl-c-marshal.c,
          src/idl-compiler/orbit-idl-c-skels.c,
          src/idl-compiler/orbit-idl-c-stubs.c,
          src/idl-compiler/orbit-idl-c-utils.c,
          src/idl-compiler/orbit-idl-main.c,
          src/idl-compiler/orbit-idl3-types.h: chop, chop.
        Remove all non-small code. Kill orbit-idl-c-demarshal.c
        and orbit-idl-c-marshal.c. Add --noidata option.

        * include/orbit/orb-core/orbit-small.h,
          include/orbit/poa/poa-types.h,
          src/orb/orb-core/orbit-small.c,
          src/orb/poa/poa.c: remove all non-small
        code.

        * src/orb/dynamic/dynany.c,
          src/orb/poa/poa.c,
          test/poa/poatest-exception.h: temp hacks
        to get around fact that orbit-idl is not
        generating aliased sequence allocbufs.

        * include/orbit/orb-core/Makefile.am,
          src/orb/dynamic/Makefile.am,
          src/orb/include/Makefile.am,
          src/orb/orb-core/Makefile.am,
          src/orb/poa/Makefile.am: kill --oldstyle,
        use --noidata.

        * test/poa/Makefile.am: depend on orbit-idl.

        * configure.in: bump up ORBIT_SERIAL.

2001-07-11  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (CORBA_Object__freekids): 
	fix brokenness.

	* src/orb/orb-core/corba-typecode.c (ORBit_TypeCode_free_fn):
	ditto.

2001-07-11  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (ORBit_POA_free_fn),
	(ORBit_POACurrent_free_fn): fix deadlocks

	* src/orb/poa/clean-poa.c (ORBit_POACurrent_free_fn),
	(ORBit_POA_free_fn): ditto.

	* src/orb/orb-core/corba-typecode.c (ORBit_TypeCode_free_fn):
	kill deadlocks.

	* src/orb/dynamic/dynany.c (DynamicAny_DynAny_release_fn):
	use ORBit_free_T to stop deadlock & don't lock on invalidate.
	(dynany_invalidate): add 'lock' argument.
	update all references.

	* src/orb/orb-core/allocators.c (ORBit_free): take
	the RootObject_lifecycle_lock, and call
	(ORBit_free_T): split out.
	(ORBit_freekids_via_TypeCode): split out to
	(ORBit_freekids_via_TypeCode_T): here & kill deadlock plague.

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_release_cb): use the non-locking
	release on obj->pobj.

2001-07-10  Michael Meeks  <michael@ximian.com>

	* configure.in: Bump version to 2.3.91

2001-07-10  Peter Williams  <peter@beta.newton.cx>

	* test/poa/Makefile.am ($(POATEST_IDLOUT)): use $<
	instead of poatest.idl for when srcdir != builddir.

2001-07-10  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/poa/poa.h(ORBit_POAInvocation):
	killed object_id and doUnuse members.

	* include/orbit/poa/portableserver-poa-type.h
	(PortableServer_POA): replaced default_pobj
	member with default_servant;

	* src/orb/poa/poa.c
	(ORBit_POA_ServantManager_{un}use_servant): pass
	a pobj instead of an iframe.
	(ORBit_handle_request): split in two. Now
	ORBit_small_handle_request can be used for local
	calls and original function is a wrapper for
	remote calls.
	Also various default_servant fixes.

	* src/orb/poa/orbit-poa-export.h: introduce
	ORBit_small_handle_request.

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_invoke_stub): call 
	ORBit_small_handle_request.

	* test/poa/poatest-basic09.c,
	  test/poa/poatest-basic10.c: commit default
	servant tests.

2001-07-09  Mark McLoughlin <mark@skynet.ie>

	* src/orb/orb-core/corba-object.c,
	  src/orb/poa/poa.c: fixed some extreme 
	braindeadness on my part.

2001-07-07  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/corba-object-type.h,
	  src/orb/orb-core/Makefile.am,
	  src/orb/orb-core/corba-object.c,
	  src/orb/orb-core/orb-core-private.h,
 	  src/orb/orb-core/iop-profiles.c,
	  src/orb/orb-core/iop-profiles.h: split off all the
	profiles stuff on its own.

2001-07-08  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-object.c
	(ORBit_RootObject_release): split out core to:
	(ORBit_RootObject_release_T): here.

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_release_cb): use the non-locking release.

	* src/orb/poa/poa.c (remove_cb): return FALSE instead of
	nothing.
	(ORBit_POAObject_release_cb): use non-locking release.

2001-07-07  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/corba-object.h,
	  src/orb/orb-core/corba-object.c,
	  src/orb/poa/poa.c: sharing is caring.
	Make the POA generated references share their
	profile_lists.

2001-07-07  Mark McLoughlin <mark@skynet.ie>

	* src/orb/orb-core/corba-object.c: don't carry around
	multiple copies of the object key. Only generate it when
	it the ref is to be exported.

	* src/orb/poa/orbit-poa-export.h,
	  src/orb/poa/poa.c: rename ORBit_POA_oid_to_okey to
	ORBit_POA_object_to_okey and export.

2001-07-07  Mark McLoughlin <mark@skynet.ie>

	* src/orb/orb-core/corba-object.c,
	  src/orb/orb-core/corba-orb.c: only opening listening
	sockets when externalising a reference.

2001-07-06  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/corba-object.h,
	  include/orbit/poa/poa-types.h,
	  src/orb/orb-core/corba-object.c,
	  src/orb/poa/orbit-poa.h,
	  src/orb/poa/poa.c: make an object reference's
	profile_list only be generated when it is about to
	be externalised.

2001-07-04  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_invoke_stub): add ORBIT_STUB_PostCall/PreCall
	ref counting checks.

2001-07-05  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/orb-core/corba-object-type.h,
	  include/orbit/poa/poa-types.h,
	  src/orb/orb-core/corba-object.c,
	  src/orb/orb-core/orbit-small.c,
	  src/orb/poa/poa.c,
	  src/services/name/orbit-name-server.c: make every reference
	created by the POA have a POAOjbect associated with it.
	s/bypass_obj/pobj/.

2001-07-05  Mark McLoughlin <mark@skynet.ie>
	
	* test/poa/poatest-basic04.c,
	  test/poa/poatest-basic05.c,
	  test/poa/poatest-basic06.c,
	  test/poa/poatest-basic07.c,
	  test/poa/poatest-basic08.c: use 
	CORBA_PolicyList_allocbuf instead of g_new0.

2001-07-04  Mark McLoughlin <mark@skynet.ie>

	* configure.in: updated glib check.

2001-07-04  Mark McLoughlin <mark@skynet.ie>

	* src/orb/orb-core/orbit-interface.idl,
	  src/idl-compiler/orbit-idl-c-common.c,
	  src/idl-compiler/orbit-idl-c-headers.c:
	added inheritance data to ORBit::IInterface.

2001-07-03  Michael Meeks  <michael@ximian.com>

	* src/orb/orbit-init.c (ORBit_init_internals): seed
	the random number generator once, properly.

	* src/orb/GIOP/giop-connection.c s/shutdown/dispose/

	* include/orbit/util/basic_types.h: include
	glib/gunicode.h Mark needs to update his glib :-)

2001-06-29  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(IOP_TAG_INTERNET_IOP_demarshal): NULL components if
	version is !> GIOP_1_0.

	* src/idl-compiler/orbit-idl-c-utils.c
	(orbit_cbe_get_typespec_str): return CORBA_wstring not
	CORBA_wchar *.

	* include/orbit/util/basic_types.h: add CORBA_wstring.

2001-06-29  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/util/basic_types.h: include gunicode.h,
	not glib/gunicode.h.

2001-06-29  Mark McLoughlin <mark@skynet.ie>

	* src/orb/poa/poa.c: fixed a couple of porblems
	with yesterday's commit.

2001-06-28  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/poa/poa-types.h,
	  src/orb/orbit-init.c,
	  src/orb/orb-core/corba-object.c,
	  src/orb/orb-core/corba-orb.c,
	  src/orb/poa/orbit-poa.h,
	  src/orb/poa/poa.c: sorted out the POA and
	POAObject ref counting mess - I hope ;)

	* src/orb/poa/poa-servants.c: remove assertions -
	not valid in MULT_ID case.

	* test/poa/poatest-basic-shell.c,
	  test/poa/poatest-basic04.c,
	  test/poa/poatest-basic05.c,
	  test/poa/poatest-basic06.c,
	  test/poa/poatest-basic07.c,
	  test/poa/poatest-basic08.c: release more refs,
	and invoke orb->destroy and orb->shutdown.

2001-06-28  Michael Meeks  <michael@ximian.com>

	* include/orbit/util/basic_types.h: include glib/gunicode.h,
	we require HEAD glib.

2001-06-26  Mark McLoughlin <mark@skynet.ie>

	* src/orb/orb-core/corba-context.c,
	src/orb/poa/poa.c: kill deprecated
	g_hash_table_(freeze|thaw) functions.

2001-06-26  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/poa/poa-types.h,
	  src/idl-compiler/orbit-idl-c-skels.c :
	kill POAObject members use_count, death_callback
	and user_data. Relics from an old hack from ORBit0
	thats not used anymore.

	* src/orb/poa/poa.c: add a few TODO items.

2001-06-26  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-skels.c
	(cbe_skel_interface_print_relayer): chop specious overall idx
	calculation.
	(cbe_skel_interface_print_relayers): calc. m_data idx per
	interface so inheritance works, sigh.

	* test/everything/everything.idl: inherit StructServer
	from BasicServer to regression test method layout under
	inheritance.

	* test/everything/structServer.c (StructServer_vepv): upd.

2001-06-26  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-connection.c
	(giop_connection_handle_input): unuse the incoming
	message off the cnx list as we handle it.

	* src/orb/orb-core/corba-orb.c
	(CORBA_ORB_run): just do a g_main_loop_run

2001-06-25  Mark McLoughlin <mark@skynet.ie>

	 * test/poa/.cvsignore: added.

2001-06-25  Mark McLoughlin <mark@skynet.ie>

	* test/poa/*: import.

	* configure.in, test/Makefile.am: add poa.

2001-06-25  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/poa/poa-types.h,
	  src/idl-compiler/orbit-idl-c-skels.c,
	  src/orb/poa/poa-servants.c,
	  src/orb/poa/poa.c : make MULT_ID work by having a list of
	POAObjects in the servant's '_private' member.

2001-06-25  Mark McLoughlin <mark@skynet.ie>

	* include/orbit/poa/poa.h: add string_to_ObjectId etc.

	* src/orb/poa/poa.c: make root POA have non default
	IMPLICIT_ACTIVATION policy.

2001-06-25  Michael Meeks  <michael@ximian.com>

	* src/orb/dynamic/dynany.c
	(CORBA_sequence_DynamicAny_NameValuePair_allocbuf),
	(CORBA_sequence_DynamicAny_NameValuePair__alloc): impl.

2001-06-25  Martin Baulig  <baulig@suse.de>

	* src/orb/dynamic/dynany.c
	(DynamicAny_DynStruct_set_members),
	(DynamicAny_DynStruct_get_members): copy from
	ORBit-martin-forked.

2001-06-25  Michael Meeks  <michael@ximian.com>

	* test/echo-server.c (main): remove hack.

	* src/orb/orb-core/corba-orb.c (idle_fn),
	(ORBit_ORB_idle_init): kill ugly hack.

2001-06-25  Martin Baulig  <baulig@suse.de>

	* src/orb/orb-core/corba-object.c: add include.

	* src/orb/GIOP/giop-connection.c
	(giop_connection_handle_input): handle request as
	it finished coming in.

2001-06-23  Martin Baulig  <baulig@suse.de>

	* configure.in: Don't output the .pc files twice.

	* src/idl-compiler/Makefile.am: s/libIDL.la/libIDL-2.la/g.

	* test/inhibit/Makefile.am: Removed $(IDLOUT), test_any_built
	and $(TEST_ANY_IDLOUT) so this actually works.

2001-06-19  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-stubs.c (cs_small_output_stub): 
	output pre / post call code even for small stubs / skels.

	* include/orbit/poa/poa-types.h: remove redundant type defines.

2001-06-19  Michael Meeks  <michael@ximian.com>

	* src/orb/util/genrand.c (genrand_unix): if ORBIT_PURIFY don't
	use bits of uninitialized stack.

2001-06-18  Erik Walthinsen  <omega@temple-baptist.com>

	* ORBit-2.0.pc.in, ORBit-CosNaming-2.0.pc.in: brought in from
	ORBit-martin-forked.

	* .cvsignore, Makefile.am, configure.in: added necessary lines
	for above .pc files to be created/installed.

2001-06-19  Mark McLoughlin <mark@skynet.ie>

	* src/orb/include/Makefile.am: use --oldstyle

	* src/orb/dynamic/Makefile.am: fix build.

	* src/orb/poa/Makefile.am: fix build.

	* test/Makefile.am: Fix build, kill -lefence.

2001-05-30  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/Makefile.am: simplify makefile ugliness.

	* test/Makefile.am (echo_built): fix recursive build
	issue.

2001-05-30  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-connection.c (giop_connection_initiate):
	only ref the connection if we didn't just destroy it.

2001-05-30  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_stub): 
	don't do an alloca (0), just use &obj - this points to
	the stack in a safer, quicker and cleaner way.

2001-05-30  Michael Meeks  <michael@ximian.com>

	* src/orb/dynamic/dynany.c (dynany_sequence_realloc_to): only
	copy old_len elements from the old buffer.

2001-05-30  Michael Meeks  <michael@ximian.com>

	* src/orb/dynamic/dynany.c: Port from ORBit-stable.

	* src/orb/orb-core/allocators.c (ORBit_free): use
	ORBit_free internaly not CORBA_free to clean stack traces.

	* src/orb/orb-core/corba-any.c (CORBA_any__freekids): ditto
	& accelerate.

	* src/orb/orb-core/corba-orb.c
	(CORBA_ORB_set_initial_reference): fix g_hash_table
	manipulation leak / bug.

2001-05-29  Michael Meeks  <michael@ximian.com>

	* src/orb/dynamic/Makefile.am: install dynamic-defs.h
	in the right place ...

	* src/orb/orb-core/corba-typecode.c: add long_double TC def.

	* src/idl-compiler/orbit-idl-c-headers.c
	(ch_type_alloc_and_tc): fixup emmission of __allocbuf as
	well as __alloc for sequences.

	* include/orbit/orb-core/corba-typecode.h: declare.
	TC_CORBA_long_double_struct and TC_CORBA_wstring_struct.

	* src/orb/orb-core/corba-any.c (CORBA_any__copy): constipate.

	* include/orbit/dynamic/dynamic.h: upd.

	* include/orbit/orbit.h: add dynamic.h

	* src/orb/dynamic/Makefile.am: add dynany.c

2001-05-25  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/Makefile.am (runidl_poa): install poa-defs into
	the correct directory, fixup the include brokenness.
	(POA_IDLOUT): add poa-defs.h - doh.

	* src/idl-compiler/orbit-idl-c-headers.c (ch_output_interface):
	output TC_ #defines even for PIDL types.

	* src/idl-compiler/orbit-idl-c-common.c
	(build_marshal_funcs): only output marshalers if we
	need to.
	(cc_output_tc_walker): Output typecode information for
	PIDL types - why not, might help automated language bindings
	to the PIDL.

2001-05-25  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c (dump): print in-buffer
	offsets as well as the data.

	* src/orb/orb-core/corba-typecode.c (tc_dec_tk_except):
	decode sub_parts sub-types not length.
	(tc_enc_tk_except): ditto for encode.
	(tc_enc): use the buffer length in the message header
	instead of the current_idx, since we now marshal straight
	into a single buffer without the encaps cruft.
	(tc_dec): fix the recursive arithmetic, make it remember
	to duplicate the recursive typecode references.

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value):
	duplicate the correct pointer.

	* src/orb/orb-core/orbit-small.c (ORBit_small_alloc): re-write
	to memset 0 the returned memory.

	* src/orb/orb-core/corba-any.c (CORBA_any__freekids): release
	the typecode pointer as well.

	* src/idl-compiler/orbit-idl-c-common.c (cc_alloc_prep): pass
	rinfo around.

2001-05-25  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-context.c (CORBA_Context_set_one_value):
	remove the hash table value, so we don't screw up the key allocation.

2001-05-24  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-connection.c (giop_connection_initiate): 
	reference the connection before returning it, if it wasn't
	looked up in the list.
	(giop_connection_remove_by_orb): fix serious brokenness.
	(giop_connection_close): publicise.
	(giop_connection_shutdown): remove the connection from the
	connection list.
	(giop_connection_unref): remove last unref sillies.

	* src/orb/orb-core/corba-object.c (g_CORBA_Object_equal): uglify,
	we need to be able to scan for MULTIPLE_COMPONENTS profiles in
	order to do the GIOP profile comparison (get_mci): impl helper.
	(IOP_Profile_equal): similarly uglify.
	(CORBA_Object_release_cb): close the connection and
	unref it.

	* src/orb/poa/poa.c (ORBit_POA_oid_to_ref): set the profile_type
	on the iiop profile.

	* src/orb/orb-core/corba-object.c (ORBit_objref_new): actualy
	insert new object references into the objrefs hash.
	(IOP_Profile_dump): impl.

2001-05-24  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (CORBA_Object_release_cb):
	only unref the connection if it is valid.
	(IOP_Profile_equal): re-order compares to accelerate & warn
	on unknown profile.

	* src/orb/GIOP/giop-connection.c (giop_connection_list_add):
	re-privatize.

	* src/orb/GIOP/giop-server.c (giop_server_handle_new_connection):
	remove - was broken.

	* src/orb/GIOP/giop-recv-buffer.c (giop_recv_buffer_data_read):
	kill warning.

	* src/orb/GIOP/giop-connection.c (giop_connection_handle_input):
	if we return FALSE set the source tag to 0, since on return it
	is removed.
	(giop_connection_real_state_changed): add some source management
	assertions.
	(giop_connection_destroy): rename to
	(giop_connection_shutdown): this.

2001-05-20  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_release_cb): remove bypass_obj unref, hmm.

2001-05-20  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-orb.c
	(ORBit_ORB_idle_init, idle_fn): FIXME these suck.

	* src/orb/GIOP/giop-recv-buffer.c
	(giop_recv_buffer_use_noblock): impl.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-headers.c
	(orbit_idl_output_c_headers): re-order.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (ORBit_POA_free_fn): free the poa's
	name and key buffer.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_release_fn): 
	free the initial refs hash.

2001-05-18  Martin Baulig  <baulig@suse.de>

	* ORBit-2.0.pc.in (Cflags): Added `-DORBIT2=1'.

2001-05-18  Martin Baulig  <baulig@suse.de>

	* ORBit-2.0.pc.in: Use `ORBit-2.0' as package name.
	* ORBit-CosNaming-2.0.pc.in: Use `ORBit-CosNaming-2.0' as name.

	* Makefile.am: Install the .pc files.

	* src/orb/orb-core/Makefile.am: Added explicit dependency
	`$(top_builddir)/include/orbit/orb-core/orbit-interface.h: runidl_iface'.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value): 
	set _release = TRUE for sequences.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_invoke_poa): fix more stupid leaks.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(IOP_TAG_ORBIT_SPECIFIC_demarshal): allocate the correct
	buffer size for the sock_path.
	(IOP_Profile_equal): fix bug in GIOP compare, and compare
	on host for IOP, impl for ORBIT_SPECIFIC and re-order to
	accelerate.
	(IOP_ObjectKey_equal): split out.
	(IOP_TAG_ORBIT_SPECIFIC_free): don't double free the profile
	itself.

	* src/orb/poa/poa.c (ORBit_POA_oid_to_ref): put the osi
	profile on the profile list, and do this later, to ensure
	that the ORBit specific profile is later than the GIOP
	profile.

	* test/everything/server.c (create_object): free the object id...

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_poa): fix misc.
	leaks.

	* src/orb/orb-core/corba-context.c (CORBA_Context_get_values): remove
	redundant call to create_list.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-server.c (giop_server_handle_new_connection): impl.
	(giop_server_class_init): hook it up.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_run): 
	unuse reliably here.

	* src/orb/poa/poa.c (ORBit_handle_request):
	remove the unuse.

	* src/orb/orb-core/corba-context.c (CORBA_Context_new): fix leak.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (PortableServer_POA_find_POA): bugfix.
	(ORBit_POA_is_inuse): 

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_init): duplicate
	the ORB before returning it.

	* src/orb/orb-core/corba-object.c (ORBit_delete_profiles): upd.
	(ORBit_handle_location_forward, ORBit_demarshal_IOR): upd.
	(CORBA_Object_release_cb): finish.
	(ORBit_objref_find): fix leak.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-typecode.c (tc_dec): remove broken
	ref set to 1.

2001-05-17  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(ORBit_profile_free): actualy free the sub-profiles.
	(IOP_TAG_INTERNET_IOP_free, IOP_TAG_GENERIC_IOP_free),
	(IOP_TAG_MULTIPLE_COMPONENTS_free, IOP_TAG_ORBIT_SPECIFIC_free): 
	impl.

	* src/orb/GIOP/giop-recv-buffer.c
	(giop_IOP_ServiceContextList_free): impl.
	(giop_recv_buffer_unuse): use it.

	* src/orb/orb-core/corba-typecode.c (tc_dec): unuse
	the encapsulated buffer after creation.

2001-05-17  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-context.c (ORBit_Context_demarshal):
	move buf->cur over the length to point at the value.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_create_list): impl.

	* src/orb/orb-core/corba-typecode.c (tc_dec_tk_sequence),
	(tc_dec_tk_alias, tc_dec_tk_array): set sub_parts to 1.
	(tc_dec): set ref count to 1.

	* src/orb/orb-core/corba-any.c (ORBit_marshal_value),
	(ORBit_demarshal_value): Make TypeCode indirection consistant
	with CORBA_Object indirection [ and in fact all other types ] -
	they are both Pseudo-objects.

	* src/orb/orb-core/corba-typecode.c (tc_dec): hack.

	* src/orb/orb-core/corba-env.c (ORBit_send_user_exception): fixup.

2001-05-16  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_skel): impl.

2001-05-16  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (CORBA_Object_non_existent): 
	reverse polarity.

	* src/orb/orb-core/orbit-small.c (ORBit_small_allocbuf):
	fix silly allocbuf bug.

	* test/everything/client.c: #include yet another
	.c file - yuck.

	* test/everything/server.c: kugly #ifdef hacks.

2001-05-14  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_non_existent): fix.

	* configure.in: add pkgconfig bits.

2001-05-12  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c: impl. context code.

2001-05-11  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value): 
	don't try to de-marshal a _maximum that isn't there.

2001-05-10  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-utils.c
	(orbit_cbe_write_param_typespec_str): split from
	(orbit_cbe_write_param_typespec_raw): here.
	(cs_small_unflatten_ref, cbe_small_unflatten_args): impl.

	* include/orbit/poa/poa-types.h:
	add ORBit_small_impl_finder, add ORBitSmallSkeleton.

2001-05-09  Michael Meeks  <michael@ximian.com>

	* test/everything/Makefile.am: remove ugly hack.

2001-05-08  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-skels.c (ck_output_small_skel): 
	impl.

	* src/idl-compiler/orbit-idl-c-utils.c
	(cs_small_flatten_ref, cbe_small_output_args): move here
	from orbit-idl-c-stubs.c

	* src/idl-compiler/orbit-idl-c-skels.c
	(cbe_skel_interface_print_relayers),
	(cbe_skel_interface_print_relayer): make small variants
	like to change sig to have const char *method, but needs
	poa work... perhaps expand the PortableServer_ClassInfo
	struct with a more sensible option ? / put it on the
	object.
	
	* src/idl-compiler/orbit-idl-c-stubs.c
	(orbit_cbe_param_printptrs): unused - kill.

2001-05-05  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-headers.c
	(orbit_idl_output_c_headers): upd.
	(ch_output_itypes, ch_output_itype): impl.

	* src/idl-compiler/orbit-idl-c-stubs.c
	(orbit_idl_output_c_stubs): upd.
	(cs_small_output_stubs, cs_small_flatten_ref),
	(cs_small_output_args, cs_small_output_small_stub): impl.

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value),
	(ORBit_marshal_value): publicise.

	* src/idl-compiler/orbit-idl-c-common.c
	(cc_small_output_itypes, cc_small_output_itype): add.

2001-05-04  Michael Meeks  <michael@ximian.com>

	* include/orbit/orb-core/allocators.h
	(ORBit_freekids_via_TypeCode): publicize.

	* src/idl-compiler/orbit-idl-c-common.c: don't dump any
	allocs if we are in small mode.

	* src/idl-compiler/orbit-idl-c-utils.c
	(orbit_cbe_get_typecode_name): add.

	* include/orbit/orb-core/orb-core.h: add orbit-small.h

	* src/idl-compiler/orbit-idl-c-headers.c (ch_output_type_enum): 
	(ch_output_interface, ch_output_type_dcl, ch_output_type_struct),
	(ch_output_type_union, ch_prep_fixed, ch_prep_sequence): pass
	rinfo around so we can get at the 'small' flag.
	(ch_prep): upd.

	* src/idl-compiler/orbit-idl-main.c (main): add arg '--small'

2001-05-04  Michael Meeks  <michael@ximian.com>

	* test/everything/*: import & port.

	* src/orb/orb-core/corba-any.c (ORBit_any_equivalent),
	copy straight from ORBit stable - no mods.
	(ORBit_value_equivalent): ditto + add scratch to union_tag
	handling.
	(ORBit_copy_value_core): fix bug in CORBA_tk_union handling

	* src/orb/orb-core/corba-typecode.c (CORBA_TypeCode_equal): copy
	straight from ORBit stable - no mods.

	* test/Makefile.am (SUBDIRS): add 'everything'

	* src/idl-compiler/orbit-idl-c-common.c (orbit_idl_output_c_common): 
	setup ORBit_zero_int as a static local.

	* include/orbit/orb-core/allocators.h (CORBA_sequence_get_release): 
	define CORBA_sequence_get_release

	* src/idl-compiler/orbit-idl-c-skels.c:
	add G_GNUC_UNUSED attribute to some potentialy unused bits.

	* src/idl-compiler/orbit-idl-c-stubs.c
	add G_GNUC_UNUSED attribute to some potentialy unused bits.
	(cs_output_stub): always generate _ORBIT_demarshal_error.

	* src/orb/orb-core/corba-any.c (CORBA_any_get_release): impl.

	* test/everything/Makefile.am: update.
