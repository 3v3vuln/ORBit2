2001-05-24  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (ORBit_objref_new): actualy
	insert new object references into the objrefs hash.
	(IOP_Profile_dump): impl.

2001-05-24  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (CORBA_Object_release_cb):
	only unref the connection if it is valid.
	(IOP_Profile_equal): re-order compares to accelerate & warn
	on unknown profile.

	* src/orb/GIOP/giop-connection.c (giop_connection_list_add):
	re-privatize.

	* src/orb/GIOP/giop-server.c (giop_server_handle_new_connection):
	remove - was broken.

	* src/orb/GIOP/giop-recv-buffer.c (giop_recv_buffer_data_read):
	kill warning.

	* src/orb/GIOP/giop-connection.c (giop_connection_handle_input):
	if we return FALSE set the source tag to 0, since on return it
	is removed.
	(giop_connection_real_state_changed): add some source management
	assertions.
	(giop_connection_destroy): rename to
	(giop_connection_shutdown): this.

2001-05-20  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_release_cb): remove bypass_obj unref, hmm.

2001-05-20  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-orb.c
	(ORBit_ORB_idle_init, idle_fn): FIXME these suck.

	* src/orb/GIOP/giop-recv-buffer.c
	(giop_recv_buffer_use_noblock): impl.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-headers.c
	(orbit_idl_output_c_headers): re-order.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (ORBit_POA_free_fn): free the poa's
	name and key buffer.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_release_fn): 
	free the initial refs hash.

2001-05-18  Martin Baulig  <baulig@suse.de>

	* ORBit-2.0.pc.in (Cflags): Added `-DORBIT2=1'.

2001-05-18  Martin Baulig  <baulig@suse.de>

	* ORBit-2.0.pc.in: Use `ORBit-2.0' as package name.
	* ORBit-CosNaming-2.0.pc.in: Use `ORBit-CosNaming-2.0' as name.

	* Makefile.am: Install the .pc files.

	* src/orb/orb-core/Makefile.am: Added explicit dependency
	`$(top_builddir)/include/orbit/orb-core/orbit-interface.h: runidl_iface'.

2001-05-19  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value): 
	set _release = TRUE for sequences.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c
	(ORBit_small_invoke_poa): fix more stupid leaks.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(IOP_TAG_ORBIT_SPECIFIC_demarshal): allocate the correct
	buffer size for the sock_path.
	(IOP_Profile_equal): fix bug in GIOP compare, and compare
	on host for IOP, impl for ORBIT_SPECIFIC and re-order to
	accelerate.
	(IOP_ObjectKey_equal): split out.
	(IOP_TAG_ORBIT_SPECIFIC_free): don't double free the profile
	itself.

	* src/orb/poa/poa.c (ORBit_POA_oid_to_ref): put the osi
	profile on the profile list, and do this later, to ensure
	that the ORBit specific profile is later than the GIOP
	profile.

	* test/everything/server.c (create_object): free the object id...

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_poa): fix misc.
	leaks.

	* src/orb/orb-core/corba-context.c (CORBA_Context_get_values): remove
	redundant call to create_list.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/GIOP/giop-server.c (giop_server_handle_new_connection): impl.
	(giop_server_class_init): hook it up.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_run): 
	unuse reliably here.

	* src/orb/poa/poa.c (ORBit_handle_request):
	remove the unuse.

	* src/orb/orb-core/corba-context.c (CORBA_Context_new): fix leak.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/poa/poa.c (PortableServer_POA_find_POA): bugfix.
	(ORBit_POA_is_inuse): 

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_init): duplicate
	the ORB before returning it.

	* src/orb/orb-core/corba-object.c (ORBit_delete_profiles): upd.
	(ORBit_handle_location_forward, ORBit_demarshal_IOR): upd.
	(CORBA_Object_release_cb): finish.
	(ORBit_objref_find): fix leak.

2001-05-18  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-typecode.c (tc_dec): remove broken
	ref set to 1.

2001-05-17  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(ORBit_profile_free): actualy free the sub-profiles.
	(IOP_TAG_INTERNET_IOP_free, IOP_TAG_GENERIC_IOP_free),
	(IOP_TAG_MULTIPLE_COMPONENTS_free, IOP_TAG_ORBIT_SPECIFIC_free): 
	impl.

	* src/orb/GIOP/giop-recv-buffer.c
	(giop_IOP_ServiceContextList_free): impl.
	(giop_recv_buffer_unuse): use it.

	* src/orb/orb-core/corba-typecode.c (tc_dec): unuse
	the encapsulated buffer after creation.

2001-05-17  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-context.c (ORBit_Context_demarshal):
	move buf->cur over the length to point at the value.

	* src/orb/orb-core/corba-orb.c (CORBA_ORB_create_list): impl.

	* src/orb/orb-core/corba-typecode.c (tc_dec_tk_sequence),
	(tc_dec_tk_alias, tc_dec_tk_array): set sub_parts to 1.
	(tc_dec): set ref count to 1.

	* src/orb/orb-core/corba-any.c (ORBit_marshal_value),
	(ORBit_demarshal_value): Make TypeCode indirection consistant
	with CORBA_Object indirection [ and in fact all other types ] -
	they are both Pseudo-objects.

	* src/orb/orb-core/corba-typecode.c (tc_dec): hack.

	* src/orb/orb-core/corba-env.c (ORBit_send_user_exception): fixup.

2001-05-16  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c (ORBit_small_invoke_skel): impl.

2001-05-16  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c (CORBA_Object_non_existent): 
	reverse polarity.

	* src/orb/orb-core/orbit-small.c (ORBit_small_allocbuf):
	fix silly allocbuf bug.

	* test/everything/client.c: #include yet another
	.c file - yuck.

	* test/everything/server.c: kugly #ifdef hacks.

2001-05-14  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-object.c
	(CORBA_Object_non_existent): fix.

	* configure.in: add pkgconfig bits.

2001-05-12  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/orbit-small.c: impl. context code.

2001-05-11  Michael Meeks  <michael@ximian.com>

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value): 
	don't try to de-marshal a _maximum that isn't there.

2001-05-10  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-utils.c
	(orbit_cbe_write_param_typespec_str): split from
	(orbit_cbe_write_param_typespec_raw): here.
	(cs_small_unflatten_ref, cbe_small_unflatten_args): impl.

	* include/orbit/poa/poa-types.h:
	add ORBit_small_impl_finder, add ORBitSmallSkeleton.

2001-05-09  Michael Meeks  <michael@ximian.com>

	* test/everything/Makefile.am: remove ugly hack.

2001-05-08  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-skels.c (ck_output_small_skel): 
	impl.

	* src/idl-compiler/orbit-idl-c-utils.c
	(cs_small_flatten_ref, cbe_small_output_args): move here
	from orbit-idl-c-stubs.c

	* src/idl-compiler/orbit-idl-c-skels.c
	(cbe_skel_interface_print_relayers),
	(cbe_skel_interface_print_relayer): make small variants
	like to change sig to have const char *method, but needs
	poa work... perhaps expand the PortableServer_ClassInfo
	struct with a more sensible option ? / put it on the
	object.
	
	* src/idl-compiler/orbit-idl-c-stubs.c
	(orbit_cbe_param_printptrs): unused - kill.

2001-05-05  Michael Meeks  <michael@ximian.com>

	* src/idl-compiler/orbit-idl-c-headers.c
	(orbit_idl_output_c_headers): upd.
	(ch_output_itypes, ch_output_itype): impl.

	* src/idl-compiler/orbit-idl-c-stubs.c
	(orbit_idl_output_c_stubs): upd.
	(cs_small_output_stubs, cs_small_flatten_ref),
	(cs_small_output_args, cs_small_output_small_stub): impl.

	* src/orb/orb-core/corba-any.c (ORBit_demarshal_value),
	(ORBit_marshal_value): publicise.

	* src/idl-compiler/orbit-idl-c-common.c
	(cc_small_output_itypes, cc_small_output_itype): add.

2001-05-04  Michael Meeks  <michael@ximian.com>

	* include/orbit/orb-core/allocators.h
	(ORBit_freekids_via_TypeCode): publicize.

	* src/idl-compiler/orbit-idl-c-common.c: don't dump any
	allocs if we are in small mode.

	* src/idl-compiler/orbit-idl-c-utils.c
	(orbit_cbe_get_typecode_name): add.

	* include/orbit/orb-core/orb-core.h: add orbit-small.h

	* src/idl-compiler/orbit-idl-c-headers.c (ch_output_type_enum): 
	(ch_output_interface, ch_output_type_dcl, ch_output_type_struct),
	(ch_output_type_union, ch_prep_fixed, ch_prep_sequence): pass
	rinfo around so we can get at the 'small' flag.
	(ch_prep): upd.

	* src/idl-compiler/orbit-idl-main.c (main): add arg '--small'

2001-05-04  Michael Meeks  <michael@ximian.com>

	* test/everything/*: import & port.

	* src/orb/orb-core/corba-any.c (ORBit_any_equivalent),
	copy straight from ORBit stable - no mods.
	(ORBit_value_equivalent): ditto + add scratch to union_tag
	handling.
	(ORBit_copy_value_core): fix bug in CORBA_tk_union handling

	* src/orb/orb-core/corba-typecode.c (CORBA_TypeCode_equal): copy
	straight from ORBit stable - no mods.

	* test/Makefile.am (SUBDIRS): add 'everything'

	* src/idl-compiler/orbit-idl-c-common.c (orbit_idl_output_c_common): 
	setup ORBit_zero_int as a static local.

	* include/orbit/orb-core/allocators.h (CORBA_sequence_get_release): 
	define CORBA_sequence_get_release

	* src/idl-compiler/orbit-idl-c-skels.c:
	add G_GNUC_UNUSED attribute to some potentialy unused bits.

	* src/idl-compiler/orbit-idl-c-stubs.c
	add G_GNUC_UNUSED attribute to some potentialy unused bits.
	(cs_output_stub): always generate _ORBIT_demarshal_error.

	* src/orb/orb-core/corba-any.c (CORBA_any_get_release): impl.

	* test/everything/Makefile.am: update.
	

Do not touch this file. Run 'rcs2log' or use bonsai
(http://cvs.gnome.org/)
